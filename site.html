<!DOCTYPE html>  
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mural P√∫blico</title>

<!-- LOGIN GOOGLE -->
<script src="https://accounts.google.com/gsi/client" async defer></script>

<style>
html, body { width: 100%; max-width: 100%; overflow-x: hidden; }
* { box-sizing: border-box; }
body {
    margin: 0;
    padding: 0;
    font-family: 'Segoe UI', sans-serif;
    background: url("https://i.pinimg.com/736x/66/fd/b6/66fdb6ca7dbf683dd3161325a9883510.jpg") no-repeat center center fixed;
    background-size: cover;
    color: #b9ffce;
    text-align: center;
}

/* LOGIN FULLSCREEN */
#loginBox {
    position: fixed; top: 0; left: 0; width: 100%; height: 100%;
    background: rgba(0,0,0,0.90);
    display: flex; flex-direction: column;
    justify-content: center; align-items: center;
    z-index: 999999;
}
#googleLogin { width: 80%; max-width: 260px; margin-top: 12px; }

/* TOPO */
.topbar {
    width: 100%;
    background: rgba(0,0,0,0.90);
    padding: 12px 15px;
    display: flex; align-items: center;
    justify-content: space-between;
    position: sticky; top: 0;
    z-index: 9999;
    box-shadow: 0 0 15px #00ffcc;
}
.radio-btn {
    width: 55px; height: 55px;
    background: #000;
    border-radius: 50%;
    font-size: 1.7rem;
    color: #fff;
    display: flex; align-items: center; justify-content: center;
    box-shadow: 0 0 12px #00ffcc;
    cursor: pointer;
}
#menuIcon {
    font-size: 2.4rem; color: #00ffcc; cursor: pointer;
}

/* MENU LATERAL */
#sideMenu {
    position: fixed; top: 0; right: -260px;
    width: 240px; height: 100%;
    background: rgba(0,0,0,0.95);
    padding-top: 80px; padding-left: 25px;
    display: flex; flex-direction: column; gap: 25px;
    transition: 0.4s;
    z-index: 10000; box-shadow: -3px 0 18px #00ffcc;
}
#sideMenu a, #sideMenu div {
    color: #00ffcc; font-size: 1.3rem;
    font-weight: bold; cursor: pointer;
}

/* FOTO PERFIL */
#perfilFoto {
    width: 95px; height: 95px;
    border-radius: 50%;
    border: 3px solid #00ffcc;
    object-fit: cover; cursor: pointer;
}

/* FEED BASE */
.feed {
    width: 95%; max-width: 650px;
    margin: 20px auto;
}

/* CAIXA DE POSTAR */
.post-box {
    background: rgba(0,0,0,0.65);
    border-radius: 30px;
    padding: 16px;
    border: 1px solid rgba(0,255,150,0.25);
    display: flex; align-items: center;
    gap: 12px;
}
.post-box textarea {
    width: 100%; padding: 12px 15px; border-radius: 25px;
    background: rgba(255,255,255,0.1);
    border: none; color: #fff;
}
.preview img, .preview video {
    width: 100%; border-radius: 12px; margin-top: 12px;
}
.remove-preview {
    background: #ff5555; padding: 7px 10px; border-radius: 10px;
    margin-top: 8px; cursor: pointer;
}

/* POST CARDS */
.post {
    background: rgba(0,0,0,0.65);
    padding: 16px;
    border-radius: 15px;
    border: 1px solid rgba(0,255,150,0.30);
    margin-bottom: 25px; text-align: left;
}
.post img, .post video {
    width: 100%; max-height: 400px; border-radius: 12px; cursor:pointer;
}

/* COMMENTS */
.comment-list {
    background: rgba(255,255,255,0.10);
    padding: 10px; border-radius: 10px;
    margin-top: 10px; display: none;
}
.comment-entry {
    padding: 10px;
    background: rgba(0,0,0,0.35);
    border-radius: 10px;
    margin-bottom: 8px;
    display: flex; gap: 10px;
    color: #ddffe8;
}

#imgModal {
    position: fixed; top: 0; left: 0;
    width: 100%; height: 100%;
    background: rgba(0,0,0,0.90);
    display: none; justify-content: center; align-items: center;
    z-index: 99999;
}
#imgModal img {
    max-width: 95%; max-height: 90%;
    border-radius: 12px;
}
#closeModal {
    position:absolute; top:20px; right:25px;
    font-size:2.5rem; cursor:pointer;
}
</style>
</head>
<body>

<!-- LOGIN -->
<div id="loginBox">
    <img src="https://i.ibb.co/JRvgqKGM/5c081edd-21e9-48fb-9a91-834cfdd112fc-removebg-preview.png">
    <div id="googleLogin"></div>
</div>

<!-- TOPO -->
<div class="topbar">
    <div class="radio-btn" id="playBtn" onclick="toggleRadio()">‚ñ∂</div>
    <div id="menuIcon" onclick="toggleMenu()">‚ò∞</div>
    <audio id="radioPlayer" src="https://stream.zeno.fm/l8ocj9i6ka2uv"></audio>
</div>

<!-- MENU -->
<div id="sideMenu">

    <div style="text-align:center;">
        <label for="fotoPerfilUpload">
            <img id="perfilFoto" src="https://cdn-icons-png.flaticon.com/512/149/149071.png">
        </label>
        <input type="file" id="fotoPerfilUpload" accept="image/*" style="display:none;">
        <div id="nomeUsuarioMenu" style="color:#00ffcc;margin-top:8px;font-weight:bold;"></div>
    </div>

    <a href="https://marcio2307.github.io/chatterreiro/chatterreiro.html" target="_blank">Bate Papo</a>
    <a href="https://marcio2307.github.io/terreiro/origens.html" target="_blank">Nossas Origens</a>
    <a href="https://marcio2307.github.io/terreiro/estudo.html" target="_blank">Estudo da Umbanda</a>
    <a href="https://marcio2307.github.io/terreiro/sala.html" target="_blank">Reuni√£o Online</a>

    <a onclick="logout()">Sair da Conta</a>
</div>

<!-- FEED + CAIXA DE POST -->
<div class="feed">
    <div class="post-box">
        <textarea id="texto" placeholder="No que voc√™ est√° pensando?"></textarea>

        <label for="imgUpload">
            <img src="https://i.pinimg.com/736x/f9/c5/fa/f9c5fa9710cdf2b510d32915cd882330.jpg" style="height:28px;cursor:pointer;">
        </label>
        <input type="file" id="imgUpload" accept="image/*,video/*" style="display:none;">
    </div>

    <div id="preview" class="preview"></div>

    <button onclick="postar()" style="margin-top:15px;background:#00ffaa;border:none;border-radius:10px;padding:12px;font-size:1rem;font-weight:bold;cursor:pointer;">
        Postar
    </button>
<!-- STORIES 2025 ‚Äì BARRA -->
<div id="storiesBar" 
style="display:flex; gap:12px; overflow-x:auto; padding:12px; margin-top:15px; width:95%; margin-left:auto; margin-right:auto;">

    <!-- SEU STORY -->
    <div id="seuStoryBox" style="text-align:center; flex-shrink:0;">
        
        <div onclick="abrirCriarStory()" id="meuStoryBtn"
            style="
                width:70px; height:70px;
                border-radius:50%; border:3px solid #00ffaa;
                overflow:hidden; display:flex; align-items:center; justify-content:center;
                background:#000; cursor:pointer;">
            <img id="meuStoryFoto" 
                 src="https://cdn-icons-png.flaticon.com/512/149/149071.png"
                 style="width:100%; height:100%; object-fit:cover;">
        </div>

        <div style="color:#00ffaa;font-size:0.80rem;font-weight:bold;margin-top:5px;">
            Novo Story
        </div>
    </div>

</div>

<!-- MODAL CRIAR STORY -->
<div id="storyModal" style="
display:none; position:fixed; top:0; left:0; width:100%; height:100%;
background:rgba(0,0,0,0.9); z-index:999999; justify-content:center; align-items:center;
flex-direction:column; color:white;">

    <textarea id="storyTexto" placeholder="Escreva algo..." 
    style="width:80%;max-width:300px;height:80px;border-radius:10px;padding:10px;background:#222;color:white;"></textarea>

    <input type="file" id="storyMedia" accept="image/*,video/*" style="margin-top:15px;">

    <button onclick="enviarStory()" 
    style="margin-top:20px;background:#00ffaa;padding:10px 25px;border:none;border-radius:10px;font-weight:bold;">
        Postar Story
    </button>

    <button onclick="fecharCriarStory()" 
    style="margin-top:15px;background:#ff5555;padding:10px 25px;border:none;border-radius:10px;">
        Cancelar
    </button>
</div>

<!-- MODAL VER STORY -->
<div id="storyViewer" style="
display:none; position:fixed; top:0; left:0; width:100%; height:100%;
background:rgba(0,0,0,0.95); z-index:999999; justify-content:center; align-items:center; flex-direction:column;">
    
    <div id="storyContent"></div>

    <span onclick="fecharStory()" 
    style="position:absolute;top:20px;right:25px;font-size:2rem;cursor:pointer;color:#fff;">‚úñ</span>
</div>

<!-- FEED PRINCIPAL -->
<h2 style="color:#00ffcc; margin-top:25px;">Publica√ß√µes</h2>
<div id="feed"></div>

<!-- MODAL DE IMAGEM -->
<div id="imgModal">
    <span id="closeModal" onclick="fechaModal()">‚úñ</span>
    <img id="modalImg">
</div>

<script>
/* LOGIN */
let usuario = localStorage.getItem("usuarioLogado") || null;
let visitante = false;

window.addEventListener("DOMContentLoaded", () => {

    const logado = localStorage.getItem("usuarioLogado");
    const temPost = new URLSearchParams(window.location.search).get("post");

    if (!logado) {

        if (temPost) {
            visitante = true;

            loginBox.style.display = "none";
            document.body.style.overflow = "auto";
            usuario = null;

            /* Desativar cria√ß√£o de posts */
            document.querySelector(".post-box").style.display = "none";
            document.querySelector("button[onclick='postar()']").style.display = "none";

            /* Ocultar stories */
            document.getElementById("storiesBar").style.display = "none";

            /* Ocultar menus */
            menuIcon.style.display = "none";
            playBtn.style.display = "none";
            radioPlayer.style.display = "none";

        } else {
            loginBox.style.display = "flex";
            document.body.style.overflow = "hidden";
        }

    } else {

        usuario = logado;
        loginBox.style.display = "none";
        document.body.style.overflow = "auto";

        const fotoSalva = localStorage.getItem("fotoPerfil_" + usuario);
        if (fotoSalva) perfilFoto.src = fotoSalva;

        nomeUsuarioMenu.textContent = usuario;
    }
});
</script>

<!-- LOGIN GOOGLE -->
<script>
document.addEventListener("DOMContentLoaded", () => {
    setTimeout(() => {

        google.accounts.id.initialize({
            client_id: "627442405379-srqriainr8okj7ldg96njd1va5bvt7oi.apps.googleusercontent.com",
            callback: handleGoogleLogin,
            auto_select: false
        });

        google.accounts.id.renderButton(
            document.getElementById("googleLogin"),
            { theme: "filled_black", size: "large", width: 270 }
        );

    }, 200);
});

function handleGoogleLogin(response) {
    const data = JSON.parse(atob(response.credential.split('.')[1]));
    const user = data.email.split("@")[0];

    usuario = user;
    localStorage.setItem("usuarioLogado", usuario);

    if (data.picture) {
        perfilFoto.src = data.picture;
        localStorage.setItem("fotoPerfil_" + usuario, data.picture);
    }

    nomeUsuarioMenu.textContent = usuario;

    setTimeout(() => location.reload(), 500);
}
</script>

<!-- FOTO DO PERFIL -->
<script>
document.getElementById("fotoPerfilUpload").addEventListener("change", function () {
    const file = this.files[0];
    if (!file) return;

    const reader = new FileReader();
    reader.onload = e => {
        const imgBase64 = e.target.result;
        localStorage.setItem("fotoPerfil_" + usuario, imgBase64);
        perfilFoto.src = imgBase64;
        document.getElementById("meuStoryFoto").src = imgBase64;
    };
    reader.readAsDataURL(file);
});
</script>

<!-- RADIO + MENU -->
<script>
let tocando = false;
function toggleRadio(){
    const radio = document.getElementById("radioPlayer");
    const btn = document.getElementById("playBtn");

    if (!tocando){ radio.play(); btn.textContent="‚è∏"; tocando=true; }
    else { radio.pause(); btn.textContent="‚ñ∂"; tocando=false; }
}
function toggleMenu(){
    sideMenu.style.right = sideMenu.style.right === "0px" ? "-260px" : "0px";
}
document.addEventListener("click", e=>{
    if(!sideMenu.contains(e.target) && !menuIcon.contains(e.target)){
        sideMenu.style.right="-260px";
    }
});
</script>

<!-- FIREBASE ‚Äì STORIES + MURAL -->
<script type="module">
import { initializeApp } 
    from "https://www.gstatic.com/firebasejs/10.14.0/firebase-app.js";

import { 
    getDatabase, ref, push, onValue, remove, set, update 
} from "https://www.gstatic.com/firebasejs/10.14.0/firebase-database.js";

const firebaseConfig = {
    apiKey: "AIzaSyAt4CeGjdbjzdtMH1qZHw6RuBFJ6SeTDKk",
    authDomain: "coletivo-f34d4.firebaseapp.com",
    databaseURL: "https://coletivo-f34d4-default-rtdb.firebaseio.com",
    projectId: "coletivo-f34d4",
    storageBucket: "coletivo-f34d4.firebasestorage.app",
    messagingSenderId: "296376447787",
    appId: "1:296376447787:web:1341c59c8087d6ac1e4b6e"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

/* =============================
      STORIES 2025 ‚Äì SISTEMA
============================= */

const storiesRef = ref(db, "coletivo_mural/stories");

/* Abrir modal criar story */
window.abrirCriarStory = () => {
    if (!usuario) return alert("Fa√ßa login.");
    storyModal.style.display = "flex";
};

/* Fechar modal criar story */
window.fecharCriarStory = () => {
    storyModal.style.display = "none";
    storyTexto.value = "";
    storyMedia.value = "";
};

/* ENVIAR STORY */
window.enviarStory = () => {
    if (!usuario) return alert("Fa√ßa login!");
    const texto = storyTexto.value.trim();
    const file = storyMedia.files[0];

    let tipo = null;
    let base64 = null;

    if (file) {
        const reader = new FileReader();
        reader.onload = e => {
            base64 = e.target.result;
            tipo = file.type.startsWith("video") ? "video" : "imagem";
            salvarStory(texto, base64, tipo);
        };
        reader.readAsDataURL(file);
    } else {
        salvarStory(texto, null, null);
    }
};

/* Salvar no Firebase */
function salvarStory(texto, midia, tipo){
    push(storiesRef, {
        usuario,
        texto,
        timestamp: Date.now(),
        imagem: tipo === "imagem" ? midia : null,
        video: tipo === "video" ? midia : null
    });
    fecharCriarStory();
}

/* LISTAR STORIES */
onValue(storiesRef, snap => {
    const bar = document.getElementById("storiesBar");
    const agora = Date.now();

    /* RESETA */
    bar.innerHTML = `
        <div id="seuStoryBox" style="text-align:center; flex-shrink:0;">
            <div onclick="abrirCriarStory()" id="meuStoryBtn"
                style="
                    width:70px;height:70px;border-radius:50%;border:3px solid #00ffaa;
                    overflow:hidden;display:flex;align-items:center;justify-content:center;
                    background:#000;cursor:pointer;">
                <img id="meuStoryFoto" 
                    src="${localStorage.getItem("fotoPerfil_"+usuario) || "https://cdn-icons-png.flaticon.com/512/149/149071.png"}"
                    style="width:100%;height:100%;object-fit:cover;">
            </div>

            <div style="color:#00ffaa;font-size:0.80rem;font-weight:bold;margin-top:5px;">
                Novo Story
            </div>
        </div>
    `;

    /* LOOP STORIES */
    snap.forEach(st => {
        const s = st.val();
        const id = st.key;

        /* Expirado? */
        if (agora - s.timestamp > 86400000) return;

        const box = document.createElement("div");
        box.style.textAlign = "center";
        box.style.flexShrink = "0";
        box.style.width = "70px";

        const circle = document.createElement("div");
        circle.style.width = "70px";
        circle.style.height = "70px";
        circle.style.borderRadius = "50%";
        circle.style.border = "3px solid #00ffaa";
        circle.style.overflow = "hidden";
        circle.style.cursor = "pointer";
        circle.style.display = "flex";
        circle.style.alignItems = "center";
        circle.style.justifyContent = "center";
        circle.style.background = "#000";

        circle.onclick = () => abrirStory(id, s);

        if (s.imagem)
            circle.innerHTML = `<img src="${s.imagem}" style="width:100%;height:100%;object-fit:cover;">`;
        else if (s.video)
            circle.innerHTML = `<video src="${s.video}" muted style="width:100%;height:100%;object-fit:cover;"></video>`;
        else
            circle.innerHTML = `<span style="color:#00ffaa;">TXT</span>`;

        const nome = document.createElement("div");
        nome.style.color = "#00ffaa";
        nome.style.fontSize = ".75rem";
        nome.style.fontWeight = "bold";
        nome.style.marginTop = "4px";
        nome.textContent = s.usuario;

        box.appendChild(circle);
        box.appendChild(nome);
        bar.appendChild(box);
    });
});

/* ABRIR STORY */
window.abrirStory = (id, s) => {
    const viewer = document.getElementById("storyViewer");
    const content = document.getElementById("storyContent");

    viewer.style.display = "flex";

    let midia = "";
    if (s.imagem) midia = `<img src="${s.imagem}" style="max-width:92%; max-height:92%; border-radius:15px;">`;
    else if (s.video) midia = `<video src="${s.video}" controls autoplay style="max-width:92%;max-height:92%;border-radius:15px;"></video>`;
    else midia = `<p style="color:white;font-size:1.4rem;">${s.texto}</p>`;

    content.innerHTML = midia;

    /* Registrar visualiza√ß√£o */
    if (usuario){
        set(ref(db, `coletivo_mural/stories/${id}/views/${usuario}`), {
            usuario,
            hora: Date.now()
        });
    }
};

/* Fechar story */
window.fecharStory = () => storyViewer.style.display = "none";

/* Excluir story */
window.excluirStory = id => {
    onValue(ref(db, "coletivo_mural/stories/"+id), snap => {
        if (!snap.exists()) return;
        if (snap.val().usuario !== usuario) return alert("Voc√™ n√£o pode excluir esse story");

        if(confirm("Excluir seu story?")){
            remove(ref(db, "coletivo_mural/stories/"+id));
            fecharStory();
        }
    }, { onlyOnce:true });
};


/* =============================
          POSTS ‚Äì MURAL
============================= */

const postsRef = ref(db, "coletivo_mural/posts");

/* Preview de foto/video */
let midiaTemp = null;
let tipoMidia = null;

imgUpload.onchange = () => {
    const file = imgUpload.files[0];
    if (!file) return;

    tipoMidia = file.type.startsWith("video") ? "video" : "imagem";

    const reader = new FileReader();
    reader.onload = e => {
        midiaTemp = e.target.result;

        if (tipoMidia === "video"){
            preview.innerHTML = `
                <video controls autoplay muted playsinline><source src="${midiaTemp}"></video>
                <div class="remove-preview" onclick="removerPreview()">Excluir v√≠deo</div>
            `;
        } else {
            preview.innerHTML = `
                <img src="${midiaTemp}">
                <div class="remove-preview" onclick="removerPreview()">Excluir imagem</div>
            `;
        }
    };
    reader.readAsDataURL(file);
};

window.removerPreview = () => {
    midiaTemp = null;
    preview.innerHTML = "";
    imgUpload.value = "";
};

/* POSTAR */
window.postar = () => {
    if (!usuario) return alert("Fa√ßa login!");

    const texto = document.getElementById("texto").value.trim();
    if (texto === "" && !midiaTemp) return;

    push(postsRef, {
        usuario,
        texto,
        imagem: tipoMidia === "imagem" ? midiaTemp : null,
        video: tipoMidia === "video" ? midiaTemp : null,
        reacoes: {},
        comentarios: {}
    });

    texto.value = "";
    removerPreview();
};

/* LISTAR POSTS */
onValue(postsRef, snap => {
    const feed = document.getElementById("feed");
    feed.innerHTML = "";

    snap.forEach(postSnap => {
        const id = postSnap.key;
        const p = postSnap.val();
        adicionarPost(id, p);
    });
});

/* Adicionar no mural */
window.adicionarPost = (id, p) => {
    const feed = document.getElementById("feed");
    const div = document.createElement("div");
    div.className = "post";

    /* M√≠dia */
    let midia = "";
    if (p.imagem) midia = `<img src="${p.imagem}" onclick="abreModal('${p.imagem}')">`;
    if (p.video) midia = `<video controls autoplay muted><source src="${p.video}"></video>`;

    const totalLikes = p.reacoes ? Object.keys(p.reacoes).length : 0;
    const totalComments = p.comentarios ? Object.keys(p.comentarios).length : 0;

    const jaCurtiu = p.reacoes && p.reacoes[usuario];

    div.innerHTML = `
        <strong style="color:#00ffcc;">${p.usuario}</strong><br><br>
        ${midia}
        <p>${p.texto}</p>

        <div class="reaction-count" onclick="mostrarCurtidas('${id}')">üëç ${totalLikes} curtidas</div>
        <div class="comment-count" onclick="toggleComentarios('${id}')">üí¨ ${totalComments} coment√°rios</div>

        <div class="actions">
            <div onclick="toggleCurtir('${id}')">üëç ${jaCurtiu ? "Voc√™ curtiu" : "Curtir"}</div>
            <div onclick="toggleComentarioBox('${id}')">üí¨ Comentar</div>
            <div onclick="compartilhar('${id}')">üì§ Compartilhar</div>
            ${p.usuario === usuario ? `<div onclick="apagarPost('${id}')">üóë Excluir</div>` : ""}
        </div>

        <div class="comment-box" id="cb_${id}" style="display:none;">
            <textarea id="ct_${id}" rows="2" placeholder="Escreva um coment√°rio..."></textarea>
            <button onclick="comentar('${id}')">Enviar</button>
        </div>

        <div class="comment-list" id="cl_${id}" style="display:none;"></div>
        <div class="comment-list" id="likes_${id}" style="display:none;"></div>
    `;

    feed.prepend(div);

    /* Carregar coment√°rios */
    if (p.comentarios){
        const lista = document.getElementById("cl_"+id);
        Object.entries(p.comentarios).forEach(([cid, c]) => {
            const item = document.createElement("div");
            item.className = "comment-entry";
            item.innerHTML = `
                <strong>${c.usuario}:</strong> ${c.texto}
                ${c.usuario === usuario ? `<span onclick="excluirComentario('${id}','${cid}')">‚ùå</span>` : ""}
            `;
            lista.appendChild(item);
        });
    }
};

/* Curtir / Descurtir */
window.toggleCurtir = postId => {
    if (!usuario) return alert("Fa√ßa login!");

    const likeRef = ref(db, `coletivo_mural/posts/${postId}/reacoes/${usuario}`);

    onValue(likeRef, snap => {
        if (snap.exists()) remove(likeRef);
        else set(likeRef, true);
    }, { onlyOnce:true });
};

/* Mostrar curtidas */
window.mostrarCurtidas = id => {
    const caixa = document.getElementById("likes_"+id);
    caixa.style.display = caixa.style.display==="block" ? "none" : "block";

    onValue(ref(db, `coletivo_mural/posts/${id}/reacoes`), snap => {
        caixa.innerHTML = "";
        if (!snap.exists()){
            caixa.innerHTML = "<p>Ningu√©m curtiu ainda.</p>";
            return;
        }
        snap.forEach(s => {
            const div = document.createElement("div");
            div.className = "comment-entry";
            div.innerHTML = `<strong>${s.key}</strong> curtiu üëç`;
            caixa.appendChild(div);
        });
    });
};

/* Abrir caixa de coment√°rios */
window.toggleComentarios = id => {
    const lista = document.getElementById("cl_"+id);
    lista.style.display = lista.style.display==="block" ? "none" : "block";
};

/* Abrir textarea comentar */
window.toggleComentarioBox = id => {
    const box = document.getElementById("cb_"+id);
    box.style.display = box.style.display==="block" ? "none" : "block";
};

/* Comentar */
window.comentar = id => {
    if (!usuario) return alert("Fa√ßa login!");
    const campo = document.getElementById("ct_"+id);
    const texto = campo.value.trim();
    if (!texto) return;

    push(ref(db, `coletivo_mural/posts/${id}/comentarios`), {
        usuario,
        texto,
        hora: new Date().toLocaleString("pt-BR")
    });

    campo.value = "";
};

/* Excluir coment√°rio */
window.excluirComentario = (postId, cid) => {
    remove(ref(db, `coletivo_mural/posts/${postId}/comentarios/${cid}`));
};

/* Excluir post */
window.apagarPost = id => {
    remove(ref(db, "coletivo_mural/posts/"+id));
};

/* Modal imagem */
window.abreModal = src => {
    modalImg.src = src;
    imgModal.style.display = "flex";
};
window.fechaModal = () => imgModal.style.display = "none";

/* Compartilhar */
window.compartilhar = postId => {
    const link = `https://marcio2307.github.io/terreiro/site.html?post=${postId}`;
    navigator.clipboard.writeText(link);
    alert("üîó Link copiado!");
    window.open(link, "_blank");
};
</script>

<!-- SOM NOTIFICA√á√ÉO -->
<audio id="notificaChat" preload="none">
    <source src="https://marcio2307.github.io/terreiro/som.mp3" type="audio/mpeg">
</audio>

<script>
(function(){
    const audio = document.getElementById("notificaChat");
    if (!audio) return;

    function liberarSom() {
        audio.volume = 1;
        audio.play().then(() => {
            audio.pause();
            audio.currentTime = 0;
        }).catch(()=>{});
    }

    ["click","touchstart","mousedown"].forEach(ev=>{
        document.addEventListener(ev, liberarSom, { once: true });
    });
})();
</script>

<!-- PRESEN√áA ONLINE -->
<script type="module">
import { getApp, initializeApp } from "https://www.gstatic.com/firebasejs/10.14.0/firebase-app.js";
import { getDatabase, ref, set, onDisconnect } from "https://www.gstatic.com/firebasejs/10.14.0/firebase-database.js";

try { getApp(); }
catch { initializeApp(firebaseConfig); }

const db2 = getDatabase();

usuario = localStorage.getItem("usuarioLogado");
const foto = localStorage.getItem("fotoPerfil_" + usuario) 
    || "https://cdn-icons-png.flaticon.com/512/149/149071.png";

if (usuario){
    const userRef = ref(db2, "chat/usuariosOnline/"+usuario);

    set(userRef, { nome:usuario, foto, online:true });
    onDisconnect(userRef).set({ nome:usuario, foto, online:false });

    let ultima = Date.now();

    document.addEventListener("mousemove", ()=>ultima=Date.now());
    document.addEventListener("keydown", ()=>ultima=Date.now());

    setInterval(()=>{
        if(Date.now()-ultima > 120000)
            set(userRef, { nome:usuario, foto, online:false });
        else
            set(userRef, { nome:usuario, foto, online:true });
    },4000);
}
</script>
