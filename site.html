<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mural Neon ‚Äì Social</title>

<!-- Google Login -->
<script src="https://accounts.google.com/gsi/client" async defer></script>

<style>
    body {
        margin: 0;
        background: #000;
        font-family: Arial, sans-serif;
        color: white;
        overflow-x: hidden;
    }

    /* ================= TELA DE LOGIN GOOGLE ================= */
    #loginBox {
        position: fixed;
        inset: 0;
        background: rgba(0,0,0,0.92);
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        z-index: 999999;
    }

    #loginBox img {
        height: 140px;
        margin-bottom: 25px;
    }

    .google-btn {
        width: 260px;
    }

    /* ================ MENU NEON ORIGINAL ================= */
    .top-menu {
        width: 100%;
        background: #0d0d0d;
        padding: 18px 0;
        display: flex;
        justify-content: center;
        gap: 50px;
        align-items: center;
        border-bottom: 2px solid #00ff8c;
        box-shadow: 0 0 15px #00ff8c;
        position: sticky;
        top: 0;
        z-index: 9999;
    }

    .top-menu.hide {
        display: none !important;
    }

    .top-menu a {
        color: #00ff8c;
        text-decoration: none;
        font-size: 22px;
        font-weight: bold;
        text-transform: uppercase;
        display: flex;
        align-items: center;
        gap: 10px;
        transition: 0.3s;
        letter-spacing: 1.2px;
        text-shadow: 0 0 10px #00ff8c, 0 0 20px #00ff8c;
    }

    .top-menu a:hover {
        transform: scale(1.12);
    }

    @media(max-width:480px){
        .top-menu { gap: 25px; padding: 15px 0; }
        .top-menu a { font-size: 16px; }
    }
</style>
</head>
<body>

<!-- ========================= LOGIN GOOGLE ========================= -->
<div id="loginBox">
    <img src="https://cdn-icons-png.flaticon.com/512/149/149071.png">
    <div id="googleLogin" class="google-btn"></div>
</div>

<!-- ========================= MENU NEON ========================= -->
<nav class="top-menu">
    <a href="https://marcio2307.github.io/chatterreiro/chatterreiro.html">
        <i class="fa-solid fa-comments"></i> BATE PAPO
    </a>

    <a href="https://marcio2307.github.io/terreiro/estudo.html">
        <i class="fa-solid fa-book"></i> ESTUDO
    </a>

    <a href="https://marcio2307.github.io/terreiro/sala.html">
        <i class="fa-solid fa-video"></i> REUNI√ÉO ONLINE
    </a>

    <a href="#" onclick="logout()">
        <i class="fa-solid fa-right-from-bracket"></i> SAIR
    </a>
</nav>

<!-- Nome + Foto do usu√°rio logado -->
<div style="text-align:center; margin-top:15px; display:none;" id="userHeader">
    <img id="userPhoto" src="" style="width:95px;height:95px;border-radius:50%;border:3px solid #00ff8c;object-fit:cover;">
    <div id="userName" style="margin-top:10px;font-size:1.2rem;color:#00ff8c;font-weight:bold;"></div>
</div>

<!-- ========================= FIREBASE + LOGIN SCRIPT ========================= -->
<script type="module">
/* ============================================================
   üî• CONFIGURA√á√ÉO DO MESMO FIREBASE DO PROJETO 2
=============================================================== */
import { initializeApp } 
    from "https://www.gstatic.com/firebasejs/10.14.0/firebase-app.js";
import { 
    getDatabase, ref, set, push, onValue, remove, update, onDisconnect 
} from "https://www.gstatic.com/firebasejs/10.14.0/firebase-database.js";

const firebaseConfig = {
    apiKey: "AIzaSyAt4CeGjdbjzdtMH1qZHw6RuBFJ6SeTDKk",
    authDomain: "coletivo-f34d4.firebaseapp.com",
    databaseURL: "https://coletivo-f34d4-default-rtdb.firebaseio.com",
    projectId: "coletivo-f34d4",
    storageBucket: "coletivo-f34d4.firebasestorage.app",
    messagingSenderId: "296376447787",
    appId: "1:296376447787:web:1341c59c8087d6ac1e4b6e"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

/* ============================================================
   üîµ LOGIN GOOGLE ‚Äì IGUAL AO PROJETO 2
=============================================================== */
window.usuario = null;
window.fotoUsuario = null;

/* Render bot√£o Google */
google.accounts.id.initialize({
    client_id: "627442405379-srqriainr8okj7ldg96njd1va5bvt7oi.apps.googleusercontent.com",
    callback: handleGoogleLogin,
    auto_select: false
});

google.accounts.id.renderButton(
    document.getElementById("googleLogin"),
    { theme: "filled_black", size: "large", width: 260 }
);

function decodeJwt(token) {
    return JSON.parse(atob(token.split('.')[1]));
}

function handleGoogleLogin(response) {
    const data = decodeJwt(response.credential);

    const user = data.email.split("@")[0];
    window.usuario = user;
    window.fotoUsuario = data.picture;

    /* SALVA NO LOCALSTORAGE */
    localStorage.setItem("usuarioLogado", user);
    localStorage.setItem("fotoPerfil_" + user, data.picture);

    /* EXIBE FOTO E NOME */
    userPhoto.src = data.picture;
    userName.textContent = user;
    userHeader.style.display = "block";

    /* ESCONDE LOGIN */
    loginBox.style.display = "none";

    iniciarPresenca();
}

/* ============================================================
   üü¢ PRESEN√áA ONLINE / OFFLINE (igual projeto 2)
=============================================================== */
function iniciarPresenca() {
    if (!usuario) return;

    const userRef = ref(db, "chat/usuariosOnline/" + usuario);

    set(userRef, { 
        nome: usuario, 
        foto: fotoUsuario, 
        online: true 
    });

    onDisconnect(userRef).set({ 
        nome: usuario, 
        foto: fotoUsuario, 
        online: false 
    });

    let ultimoToque = Date.now();

    function atividade() {
        ultimoToque = Date.now();
        set(userRef, { nome: usuario, foto: fotoUsuario, online: true });
    }

    ["click","mousemove","keydown","touchstart","scroll"]
    .forEach(ev => document.addEventListener(ev, atividade));

    setInterval(() => {
        const tempo = Date.now() - ultimoToque;
        if (tempo >= 120000) {
            set(userRef, { nome: usuario, foto: fotoUsuario, online: false });
        }
    }, 5000);
}

/* ============================================================
   üü£ LOGOUT
=============================================================== */
window.logout = function () {
    localStorage.removeItem("usuarioLogado");
    google.accounts.id.disableAutoSelect();

    setTimeout(() => location.reload(), 300);
};
</script>

<!-- PARTE 1 FINALIZADA -->
<!-- ============================= STORIES VISUAL NEON ============================= -->

<style>
    /* Container geral dos stories */
    .stories-wrapper {
        padding: 15px 10px 5px 10px;
    }

    .stories-row {
        display: flex;
        gap: 12px;
        overflow-x: auto;
    }

    .stories-row::-webkit-scrollbar {
        height: 5px;
    }
    .stories-row::-webkit-scrollbar-thumb {
        background: #00ff8c;
        border-radius: 10px;
    }

    /* Card padr√£o */
    .story-card {
        width: 95px;
        height: 150px;
        background: #1a1c1e;
        border-radius: 15px;
        overflow: hidden;
        flex-shrink: 0;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        border: 2px solid #00ff8c;
        box-shadow: 0 0 15px #00ff8c;
    }

    /* Criar story */
    .create-story-btn {
        width: 55px;
        height: 55px;
        background: #00ff8c;
        border-radius: 50%;
        font-size: 35px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: #003b23;
        border: 3px solid #0e0f10;
        box-shadow: 0 0 20px #00ff8c;
    }

    /* Thumb dentro do card */
    .story-card img,
    .story-card video {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }

    /* VIEWER */
    #viewer {
        position: fixed;
        inset: 0;
        background: rgba(0,0,0,0.90);
        display: none;
        align-items: center;
        justify-content: center;
        z-index: 999999;
        flex-direction: column;
    }

    #viewerMedia img,
    #viewerMedia video {
        max-width: 90%;
        max-height: 80%;
        border-radius: 15px;
    }

    /* Barras do topo */
    .topBars {
        position: absolute;
        top: 15px;
        left: 0;
        width: 100%;
        display: flex;
        gap: 5px;
        padding: 0 10px;
        z-index: 10;
    }

    .bar {
        flex: 1;
        height: 4px;
        background: rgba(255,255,255,0.3);
        border-radius: 3px;
        overflow: hidden;
    }

    .barFill {
        width: 0%;
        height: 100%;
        background: #00ff8c;
        transition: width linear;
        box-shadow: 0 0 12px #00ff8c;
    }

    /* Bot√£o tr√™s pontinhos */
    .dots {
        position: absolute;
        top: 18px;
        right: 20px;
        font-size: 34px;
        cursor: pointer;
        z-index: 15;
    }

    /* Bot√£o excluir */
    .deleteBtn {
        position: absolute;
        top: 65px;
        right: 22px;
        background: #00ff8c;
        color: black;
        padding: 10px 14px;
        border-radius: 8px;
        font-weight: bold;
        cursor: pointer;
        display: none;
        z-index: 20;
    }
</style>

<!-- ============================= STORIES HTML ============================= -->

<div class="stories-wrapper">
    <div class="stories-row" id="storiesRow">

        <!-- Bot√£o de criar story -->
        <div class="story-card" onclick="abrirCriarStory()">
            <div class="create-story-btn">+</div>
        </div>

    </div>
</div>

<!-- Modal Criar Story -->
<div id="storyModal" style="
    position:fixed; inset:0;
    background:rgba(0,0,0,0.9);
    display:none;
    z-index:999999;
    justify-content:center;
    align-items:center;
    flex-direction:column;
">
    <textarea id="storyTexto" placeholder="Escreva algo..."
    style="width:80%;max-width:300px;height:80px;border-radius:10px;padding:10px;background:#222;color:white;"></textarea>

    <input type="file" id="storyMedia" accept="image/*,video/*"
    style="margin-top:15px;">

    <button onclick="enviarStory()" 
    style="margin-top:20px;background:#00ff8c;padding:12px 25px;border:none;border-radius:10px;font-weight:bold;">
        Postar Story
    </button>

    <button onclick="fecharCriarStory()" 
    style="margin-top:15px;background:#ff5555;padding:10px 25px;border:none;border-radius:10px;">
        Cancelar
    </button>
</div>

<!-- VIEWER STORY -->
<div id="viewer">
    <div class="topBars" id="bars"></div>
    <div class="dots" id="dots">‚ãÆ</div>
    <div class="deleteBtn" id="deleteBtn">Excluir</div>
    <div id="viewerMedia"></div>
</div>

<!-- ============================= STORIES SCRIPT ============================= -->

<script type="module">
import { 
    getDatabase, ref, push, onValue, remove, set 
} from "https://www.gstatic.com/firebasejs/10.14.0/firebase-database.js";

const db2 = getDatabase();

/* ABRIR / FECHAR MODAL DE CRIA√á√ÉO */
window.abrirCriarStory = function () {
    if (!usuario) return alert("Fa√ßa login!");
    storyModal.style.display = "flex";
};

window.fecharCriarStory = function () {
    storyModal.style.display = "none";
    storyTexto.value = "";
    storyMedia.value = "";
};

/* ENVIAR STORY */
window.enviarStory = function () {
    if (!usuario) return;

    const texto = storyTexto.value.trim();
    const file = storyMedia.files[0];

    let base64 = null;
    let tipo = null;

    if (file) {
        const reader = new FileReader();
        reader.onload = e => {
            base64 = e.target.result;
            tipo = file.type.startsWith("video") ? "video" : "imagem";
            salvarStory(texto, base64, tipo);
        };
        reader.readAsDataURL(file);
    } else {
        salvarStory(texto, null, null);
    }
};

function salvarStory(texto, midia, tipo) {
    push(ref(db2, "coletivo_mural/stories"), {
        usuario,
        texto,
        timestamp: Date.now(),
        imagem: tipo === "imagem" ? midia : null,
        video: tipo === "video" ? midia : null
    });

    fecharCriarStory();
}

/* ==================== CARREGAR STORIES DO FIREBASE ==================== */

onValue(ref(db2, "coletivo_mural/stories"), snap => {
    const row = document.getElementById("storiesRow");

    // MANT√âM apenas o primeiro card (criar)
    row.innerHTML = `
        <div class="story-card" onclick="abrirCriarStory()">
            <div class="create-story-btn">+</div>
        </div>
    `;

    const agora = Date.now();

    snap.forEach(story => {
        const s = story.val();
        const id = story.key;

        // Expira em 24h
        if (agora - s.timestamp > 86400000) return;

        const card = document.createElement("div");
        card.className = "story-card";

        if (s.imagem)
            card.innerHTML = `<img src="${s.imagem}">`;
        else if (s.video)
            card.innerHTML = `<video src="${s.video}" muted></video>`;
        else
            card.innerHTML = `<p style="padding:10px;">${s.texto}</p>`;

        card.onclick = () => abrirStory(id, s);

        row.appendChild(card);
    });
});

/* ==================== VIEWER ==================== */

let currentStory = null;

window.abrirStory = function (id, s) {
    currentStory = id;

    viewer.style.display = "flex";

    let media = "";

    if (s.imagem)
        media = `<img src="${s.imagem}">`;
    else if (s.video)
        media = `<video src="${s.video}" controls autoplay></video>`;
    else
        media = `<p style="font-size:1.4rem;">${s.texto}</p>`;

    viewerMedia.innerHTML = media;

    /* Registrar visualiza√ß√£o */
    if (usuario) {
        set(ref(db2, `coletivo_mural/stories/${id}/views/${usuario}`), {
            usuario,
            hora: Date.now()
        });
    }

    /* Mostrar bot√£o excluir apenas para o dono */
    if (usuario && s.usuario === usuario) {
        deleteBtn.style.display = "block";
    } else {
        deleteBtn.style.display = "none";
    }

    dots.onclick = () => {
        deleteBtn.style.display =
            deleteBtn.style.display === "block" ? "none" : "block";
    };
};

window.fecharStory = function () {
    viewer.style.display = "none";
    deleteBtn.style.display = "none";
};

window.excluirStory = function () {
    if (!currentStory) return;

    if (confirm("Excluir seu story?")) {
        remove(ref(db2, "coletivo_mural/stories/" + currentStory));
        fecharStory();
    }
};
</script>

<!-- PARTE 2 FINALIZADA -->
<!-- ====================== FEED NEON ====================== -->

<style>
    .create-post {
        background:#0d0d0d;
        margin:10px 15px;
        padding:15px;
        border-radius:20px;
        border:1px solid #00ff9d;
        display:flex;
        gap:10px;
        align-items:center;
        box-shadow:0 0 10px #00ff9d;
    }

    .input-box {
        flex:1;
        background:#111;
        padding:10px 18px;
        border-radius:30px;
        border:1px solid #00ff9d;
        color:#fff;
        font-size:16px;
        outline:none;
        box-shadow: inset 0 0 8px #00ff9d;
    }

    .add-btn {
        background:#111;
        border:2px solid #00ff9d;
        color:#00ff9d;
        width:45px;
        height:45px;
        border-radius:50%;
        font-size:22px;
        display:flex;
        align-items:center;
        justify-content:center;
        cursor:pointer;
        box-shadow:0 0 10px #00ff9d;
    }

    .preview {
        margin:10px 15px;
        padding:15px;
        background:#0d0d0d;
        border:1px solid #00ff9d;
        border-radius:15px;
        box-shadow:0 0 10px #00ff9d;
        display:none;
    }

    .post {
        background:#0d0d0d;
        margin:15px;
        padding:15px;
        border-radius:15px;
        border:1px solid #00ff9d;
        box-shadow:0 0 10px #00ff9d;
        position:relative;
    }

    .post img, .post video {
        width:100%;
        border-radius:10px;
        margin-top:10px;
    }

    .menu-btn {
        position:absolute;
        top:10px;
        right:10px;
        font-size:28px;
        color:#00ff9d;
        cursor:pointer;
    }

    .menu-box {
        position:absolute;
        top:45px;
        right:10px;
        background:#00ff9d;
        color:#000;
        padding:10px 15px;
        border-radius:8px;
        display:none;
        font-weight:bold;
        cursor:pointer;
    }

    .post-actions {
        display:flex;
        justify-content:space-around;
        margin-top:15px;
    }

    .btn-action {
        color:#00ff9d;
        padding:8px;
        border-radius:10px;
        cursor:pointer;
        font-size:15px;
        font-weight:bold;
    }

    .contador {
        margin-top:5px;
        font-size:13px;
        color:#00ff9d;
        text-align:center;
    }

    .coment-area {
        background:#111;
        padding:10px;
        margin-top:10px;
        border-radius:10px;
        display:none;
    }

    textarea {
        width:100%;
        background:#000;
        border:1px solid #00ff9d;
        border-radius:10px;
        padding:10px;
        color:white;
        resize:none;
    }
</style>

<!-- ====================== FEED HTML ====================== -->

<div class="create-post">
    <input type="text" id="postText" class="input-box"
           placeholder="No que voc√™ est√° pensando?">

    <div class="add-btn" id="btnFile" onclick="fileInput.click()">+</div>
    <input type="file" id="fileInput" accept="image/*,video/*" style="display:none;">
</div>

<div class="preview" id="previewBox">
    <h3>Pr√©via da m√≠dia</h3>
    <div id="previewContent"></div>

    <button onclick="removerPreview()" 
    style="margin-top:15px;background:#ff4444;padding:10px 15px;border:none;border-radius:12px;color:white;font-weight:bold;">
        Remover
    </button>
</div>

<div id="feed"></div>

<!-- ====================== FEED SCRIPT ====================== -->

<script type="module">
import { 
    getDatabase, ref, push, set, remove, onValue 
} from "https://www.gstatic.com/firebasejs/10.14.0/firebase-database.js";

const db3 = getDatabase();

/* --------- PREVIEW DE M√çDIA --------- */
let midiaTemp = null;
let tipoMidia = null;

fileInput.onchange = e => {
    const file = e.target.files[0];
    if (!file) return;

    tipoMidia = file.type.startsWith("video") ? "video" : "imagem";

    const reader = new FileReader();
    reader.onload = ev => {
        midiaTemp = ev.target.result;

        previewBox.style.display = "block";

        if (tipoMidia === "imagem") {
            previewContent.innerHTML = `<img src="${midiaTemp}" style="width:100%;border-radius:10px;">`;
        } else {
            previewContent.innerHTML = `<video src="${midiaTemp}" controls style="width:100%;border-radius:10px;"></video>`;
        }
    };
    reader.readAsDataURL(file);
};

window.removerPreview = function () {
    midiaTemp = null;
    tipoMidia = null;
    previewBox.style.display = "none";
    previewContent.innerHTML = "";
    fileInput.value = "";
};

/* --------- POSTAR --------- */
window.postar = function () {
    const texto = postText.value.trim();
    if (!usuario) return alert("Fa√ßa login!");
    if (texto === "" && !midiaTemp) return;

    const dados = {
        usuario,
        texto,
        imagem: tipoMidia === "imagem" ? midiaTemp : null,
        video: tipoMidia === "video" ? midiaTemp : null,
        timestamp: Date.now(),
        reacoes: {},
        comentarios: {}
    };

    push(ref(db3, "coletivo_mural/posts"), dados);

    postText.value = "";
    removerPreview();
};

/* --------- LISTAR POSTS --------- */
onValue(ref(db3, "coletivo_mural/posts"), snap => {
    const feed = document.getElementById("feed");
    feed.innerHTML = "";

    const urlParams = new URLSearchParams(window.location.search);
    const postID = urlParams.get("post");

    if (postID) {
        const p = snap.child(postID).val();
        if (!p) {
            feed.innerHTML = "<h2>Post n√£o encontrado.</h2>";
        } else {
            mostrarPostUnico(postID, p);
        }
        return;
    }

    // LOOP NORMAL DO FEED
    let lista = [];
    snap.forEach(s => lista.push({ id: s.key, ...s.val() }));
    lista.reverse();

    lista.forEach(p => addPost(p.id, p));
});

/* --------- GERAR HTML DE POST --------- */
function addPost(id, p) {
    const div = document.createElement("div");
    div.className = "post";

    let midia = "";
    if (p.imagem) midia = `<img src="${p.imagem}" onclick="abreModal('${p.imagem}')">`;
    if (p.video) midia = `<video src="${p.video}" controls></video>`;

    const totalCurtidas = p.reacoes ? Object.keys(p.reacoes).length : 0;
    const totalComentarios = p.comentarios ? Object.keys(p.comentarios).length : 0;
    const curtiu = p.reacoes && p.reacoes[usuario];

    div.innerHTML = `
        <div class="menu-btn" onclick="toggleMenu('${id}')">‚ãÆ</div>
        <div class="menu-box" id="menu_${id}">
            ${p.usuario === usuario ? `<div onclick="excluirPost('${id}')">Excluir</div>` : ""}
            <div onclick="compartilhar('${id}')">Compartilhar</div>
        </div>

        <h3 style="color:#00ff9d;">${p.usuario}</h3>
        <p>${p.texto}</p>
        ${midia}

        <div class="post-actions">
            <div class="btn-action" onclick="curtir('${id}')">üëç ${curtiu ? "Voc√™" : "Curtir"}</div>
            <div class="btn-action" onclick="abrirComentarios('${id}')">üí¨ Coment√°rios</div>
            <div class="btn-action" onclick="compartilhar('${id}')">‚ÜóÔ∏è Compartilhar</div>
        </div>

        <div class="contador">üëç ${totalCurtidas} | üí¨ ${totalComent√°rios}</div>

        <div class="coment-area" id="comentarios_${id}">
            <div id="listaComentarios_${id}"></div>
            <textarea id="comentInput_${id}" placeholder="Escreva um coment√°rio..."></textarea>
            <button onclick="enviarComentario('${id}')"
            style="margin-top:6px;background:#00ff9d;padding:8px 12px;border:none;border-radius:8px;font-weight:bold;">
                Enviar
            </button>
        </div>
    `;

    feed.appendChild(div);

    carregarComentarios(id, p);
}

/* --------- CURTIR --------- */
window.curtir = function (id) {
    if (!usuario) return alert("Fa√ßa login!");

    const likeRef = ref(db3, `coletivo_mural/posts/${id}/reacoes/${usuario}`);

    onValue(likeRef, snap => {
        if (snap.exists()) remove(likeRef);
        else set(likeRef, true);
    }, { onlyOnce: true });
};

/* --------- COMENT√ÅRIOS --------- */
window.abrirComentarios = function (id) {
    const box = document.getElementById("comentarios_" + id);
    box.style.display = box.style.display === "block" ? "none" : "block";
};

function carregarComentarios(id, p) {
    const lista = document.getElementById("listaComentarios_" + id);
    if (!lista) return;

    lista.innerHTML = "";

    if (p.comentarios) {
        Object.entries(p.comentarios).forEach(([cid, c]) => {
            const el = document.createElement("div");
            el.style = `
                background:#000;border:1px solid #00ff9d;padding:8px;
                margin:5px 0;border-radius:10px;
            `;
            el.innerHTML = `<b style="color:#00ff9d">${c.usuario}:</b> ${c.texto}`;
            lista.appendChild(el);
        });
    }
}

window.enviarComentario = function (id) {
    if (!usuario) return alert("Fa√ßa login!");
    const campo = document.getElementById("comentInput_" + id);
    const texto = campo.value.trim();
    if (!texto) return;

    push(ref(db3, `coletivo_mural/posts/${id}/comentarios`), {
        usuario,
        texto,
        hora: Date.now()
    });

    campo.value = "";
};

/* --------- EXCLUIR POST --------- */
window.excluirPost = function (id) {
    if (confirm("Excluir post?")) {
        remove(ref(db3, "coletivo_mural/posts/" + id));
    }
};

/* --------- MENU DO POST --------- */
window.toggleMenu = function (id) {
    const box = document.getElementById("menu_" + id);
    box.style.display = box.style.display === "block" ? "none" : "block";
};

/* --------- COMPARTILHAR --------- */
window.compartilhar = function (id) {
    const link = `${location.origin}${location.pathname}?post=${id}`;
    navigator.clipboard.writeText(link);
    alert("Link copiado!");
};

/* --------- POST INDIVIDUAL --------- */
window.mostrarPostUnico = function (id, p) {
    const feed = document.getElementById("feed");
    feed.innerHTML = "";

    let midia = "";
    if (p.imagem) midia = `<img src="${p.imagem}">`;
    if (p.video) midia = `<video src="${p.video}" controls></video>`;

    feed.innerHTML = `
        <div class="post">
            <h2 style="color:#00ff9d;">${p.usuario}</h2>
            ${midia}
            <p>${p.texto}</p>

            <button onclick="location.href='site.html'"
            style="margin-top:15px;background:#00ff9d;border:none;padding:12px;border-radius:12px;font-weight:bold;">
                Voltar ao mural
            </button>
        </div>
    `;
};
</script>

<!-- PARTE 3 FINALIZADA -->
<!-- ====================== MODAL DE IMAGEM ====================== -->

<style>
#imgModal {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.92);
    display: none;
    justify-content: center;
    align-items: center;
    z-index: 999999;
}

#modalImg {
    max-width: 95%;
    max-height: 90%;
    border-radius: 12px;
}

#closeModal {
    position: absolute;
    top: 20px;
    right: 25px;
    font-size: 2.5rem;
    cursor: pointer;
    color: white;
}
</style>

<div id="imgModal">
    <span id="closeModal" onclick="fechaModal()">‚úñ</span>
    <img id="modalImg">
</div>

<script>
window.abreModal = function (src) {
    modalImg.src = src;
    imgModal.style.display = "flex";
};

window.fechaModal = function () {
    imgModal.style.display = "none";
};
</script>

<!-- ====================== NOTIFICA√á√ïES DE CHAT ====================== -->

<audio id="notificaChat" preload="none">
    <source src="https://marcio2307.github.io/terreiro/som.mp3" type="audio/mpeg">
</audio>

<script>
(function(){
    const audio = document.getElementById("notificaChat");
    if (!audio) return;

    function liberarSom() {
        audio.volume = 1;

        audio.play().then(() => {
            audio.pause();
            audio.currentTime = 0;
        }).catch(()=>{});
    }

    ["click","touchstart"].forEach(ev=>{
        document.addEventListener(ev, liberarSom, { once:true });
    });
})();
</script>

<script type="module">
import { 
    getDatabase, ref, onValue 
} from "https://www.gstatic.com/firebasejs/10.14.0/firebase-database.js";

const db4 = getDatabase();

/* üîî SISTEMA DE NOTIFICA√á√ÉO DE CHAT (igual Projeto 2) */
if (localStorage.getItem("usuarioLogado")) {

    const usuario = localStorage.getItem("usuarioLogado");

    const convRef = ref(db4, "chat/conversas");

    onValue(convRef, snap => {
        if (!snap.exists()) return;

        snap.forEach(room => {
            const roomId = room.key;

            // Verifica se a conversa pertence ao usu√°rio
            if (!roomId.includes(usuario)) return;

            let ultima = null;

            room.forEach(msg => ultima = msg.val());

            if (!ultima) return;

            if (ultima.de !== usuario) {
                const som = document.getElementById("notificaChat");
                som.currentTime = 0;
                som.play().catch(()=>{});
            }
        });
    });
}
</script>

<!-- ====================== AJUSTES FINAIS E FECHAMENTO ====================== -->

<script>
/* Fechar menu do post quando clicar fora */
document.addEventListener("click", function(e) {
    document.querySelectorAll(".menu-box").forEach(box => {
        if (!box.contains(e.target) && !box.previousElementSibling.contains(e.target)) {
            box.style.display = "none";
        }
    });
});

/* Se o usu√°rio j√° estava logado, restaurar nome e foto */
document.addEventListener("DOMContentLoaded", () => {
    const u = localStorage.getItem("usuarioLogado");
    if (u) {
        usuario = u;
        fotoUsuario = localStorage.getItem("fotoPerfil_" + u);

        userPhoto.src = fotoUsuario;
        userName.textContent = usuario;
        userHeader.style.display = "block";

        loginBox.style.display = "none";
    }
});
</script>

</body>
</html>

