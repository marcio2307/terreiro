<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Stories + Feed Neon</title>

<style>
    body {
        margin: 0;
        background: #000;
        font-family: Arial, sans-serif;
        color: white;
    }

    /* ---------------- STORIES ---------------- */

    .stories-wrapper {
        padding: 15px 10px 5px 10px;
    }

    .stories-row {
        display: flex;
        gap: 10px;
        overflow-x: auto;
    }

    .stories-row::-webkit-scrollbar {
        height: 5px;
    }
    .stories-row::-webkit-scrollbar-thumb {
        background: #00ff8c;
        border-radius: 10px;
    }

    .card {
        width: 110px;
        height: 180px;
        background: #1a1c1e;
        border-radius: 15px;
        overflow: hidden;
        position: relative;
        cursor: pointer;
        display: flex;
        justify-content: center;
        align-items: center;
        flex-direction: column;
        transition: 0.3s;
        flex-shrink: 0;
    }

    #card2 { display: none; }

    .plus {
        width: 55px;
        height: 55px;
        background: #00ff8c;
        border-radius: 50%;
        font-size: 38px;
        border: 4px solid #0e0f10;
        display: flex;
        align-items: center;
        justify-content: center;
        color: #003b23;
        text-shadow: 0 0 10px #00ff8c;
        box-shadow: 0 0 25px #00ff8c;
    }

    #thumb img,
    #thumb video {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }

    .neonEffect {
        animation: neonGlow 1.7s ease-out;
        border: 3px solid transparent;
        background-image: linear-gradient(#1a1c1e, #1a1c1e),
        linear-gradient(90deg, #00ff8c, #00ffaa, #00ff8c);
        background-origin: border-box;
        background-clip: padding-box, border-box;
        box-shadow: 0 0 25px #00ff8c;
    }

    @keyframes neonGlow {
        0% { transform: scale(1); box-shadow: 0 0 5px #00ff8c; }
        50% { transform: scale(1.05); box-shadow: 0 0 35px #00ff8c; }
        100% { transform: scale(1); box-shadow: 0 0 5px #00ff8c; }
    }

    #viewer {
        position: fixed;
        inset: 0;
        background: rgba(0,0,0,0.92);
        display: none;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        z-index: 999;
    }

    #viewerMedia img,
    #viewerMedia video {
        max-width: 90%;
        max-height: 80%;
        border-radius: 15px;
    }

    .topBars {
        position: absolute;
        top: 15px;
        left: 0;
        width: 100%;
        display: flex;
        gap: 5px;
        padding: 0 10px;
        z-index: 10;
    }

    .bar {
        flex: 1;
        height: 4px;
        background: rgba(255,255,255,0.3);
        border-radius: 3px;
        overflow: hidden;
    }

    .barFill {
        width: 0%;
        height: 100%;
        background: #00ff8c;
        box-shadow: 0 0 15px #00ff8c;
        transition: width linear;
    }

    .dots {
        position: absolute;
        top: 15px;
        right: 25px;
        font-size: 35px;
        cursor: pointer;
        z-index: 20;
    }

    .deleteBtn {
        position: absolute;
        top: 60px;
        right: 25px;
        background: #00ff8c;
        color: black;
        padding: 10px 15px;
        border-radius: 8px;
        cursor: pointer;
        display: none;
        font-size: 16px;
        z-index: 20;
        font-weight: bold;
        box-shadow: 0 0 12px #00ff8c;
    }

    .tapLeft, .tapRight {
        position: absolute;
        top: 0;
        height: 100%;
        width: 50%;
        z-index: 5;
    }

    .tapLeft { left: 0; }
    .tapRight { right: 0; }

    /* ---------------- FEED ---------------- */

    .create-post{
        background:#0d0d0d;
        margin:10px 15px 15px 15px;
        padding:15px;
        border-radius:20px;
        border:1px solid #00ff9d;
        display:flex;
        gap:10px;
        align-items:center;
        box-shadow:0 0 10px #00ff9d;
    }

    .input-box{
        flex:1;
        background:#111;
        padding:10px 18px;
        border-radius:30px;
        border:1px solid #00ff9d;
        color:#fff;
        font-size:16px;
        outline:none;
        box-shadow:inset 0 0 8px #00ff9d;
    }

    /* BOT√ÉO '+' AJUSTADO */
    .add-btn{
        background:#111;
        border:2px solid #00ff9d;
        color:#00ff9d;
        width:45px;
        height:45px;
        border-radius:50%;
        font-size:22px;
        font-weight:bold;
        display:flex;
        align-items:center;
        justify-content:center;
        cursor:pointer;
        box-shadow:0 0 10px #00ff9d;
        transition:.3s;
    }

    /* üî• BOT√ÉO WHATSAPP NEON */
    .whatsapp-send{
        width:45px;
        height:45px;
        background:#00ff9d;
        border-radius:50%;
        display:flex;
        align-items:center;
        justify-content:center;
        font-size:26px;
        color:#003b23;
        cursor:pointer;
        box-shadow:0 0 15px #00ff9d;
        transition:.3s;
        border:2px solid #003b23;
    }

    #fileInput{display:none;}

    .preview{
        margin:0 15px 15px 15px;
        padding:15px;
        background:#0d0d0d;
        border:1px solid #00ff9d;
        border-radius:15px;
        box-shadow:0 0 10px #00ff9d;
        display:none;
    }

    .post{
        background:#0d0d0d;
        margin:15px;
        padding:15px;
        border-radius:15px;
        border:1px solid #00ff9d;
        box-shadow:0 0 10px #00ff9d;
        position:relative;
    }

    .post img,.post video{
        width:100%;
        border-radius:10px;
        margin-top:10px;
    }

    .post-actions{
        display:flex;
        justify-content:space-around;
        margin-top:15px;
    }

    .btn-action{
        color:#00ff9d;
        padding:8px;
        border-radius:10px;
        font-weight:bold;
        cursor:pointer;
        transition:0.3s;
        text-align:center;
    }

    .contador{
        margin-top:5px;
        font-size:13px;
        color:#00ff9d;
        text-align:center;
    }

    .coment-area{
        background:#111;
        padding:10px;
        margin-top:10px;
        border-radius:10px;
        display:none;
    }

    @media (max-width:480px){
        .card{
            width:95px;
            height:170px;
        }
        .add-btn, .whatsapp-send{
            width:42px;
            height:42px;
            font-size:22px;
        }
        .btn-action{
            font-size:13px;
        }
    }
</style>
</head>
<body>

<!-- ================= STORIES ================= -->
<div class="stories-wrapper">
    <div class="stories-row">
        <div class="card" id="card1">
            <label for="upload"><div class="plus">+</div></label>
            <input id="upload" type="file" accept="image/*,video/*" style="display:none;">
            <span style="margin-top:10px;">Criar Story</span>
        </div>

        <div class="card" id="card2">
            <div id="thumb"></div>
        </div>
    </div>
</div>

<!-- VIEWER -->
<div id="viewer">
    <div class="topBars" id="bars"></div>
    <div class="dots" id="dots">‚ãÆ</div>
    <div class="deleteBtn" id="deleteBtn">Excluir</div>
    <div class="tapLeft" id="tapLeft"></div>
    <div class="tapRight" id="tapRight"></div>
    <div id="viewerMedia"></div>
</div>

<script>
/* ---------------- STORIES SCRIPT COMPLETO ---------------- */
let stories = [];
let current = 0;

upload.onchange = e => {
    let file = e.target.files[0];
    if (!file) return;
    addStory(file);
};

function addStory(file) {
    let url = URL.createObjectURL(file);

    stories.push({ url, type: file.type });

    updateThumb();

    card2.classList.add("neonEffect");
    setTimeout(() => card2.classList.remove("neonEffect"), 1700);
}

function updateThumb() {
    if (stories.length === 0) {
        card2.style.display = "none";
        return;
    }

    card2.style.display = "flex";

    let last = stories[stories.length - 1];

    if (last.type.includes("image"))
        thumb.innerHTML = `<img src="${last.url}">`;
    else 
        thumb.innerHTML = `<video src="${last.url}" autoplay muted loop></video>`;
}

card2.onclick = () => {
    if (stories.length === 0) return;
    openViewer(0);
};

function openViewer(idx) {
    current = idx;
    viewer.style.display = "flex";
    showStory();
}

function showStory() {
    viewerMedia.innerHTML = "";
    bars.innerHTML = "";

    let total = stories.length;

    for (let i = 0; i < total; i++) {
        let bar = document.createElement("div");
        bar.className = "bar";

        let fill = document.createElement("div");
        fill.className = "barFill";
        bar.appendChild(fill);

        bars.appendChild(bar);

        if (i < current) fill.style.width = "100%";
        if (i === current) fill.id = "currentFill";
    }

    let s = stories[current];
    let el;

    if (s.type.includes("image")) {
        el = document.createElement("img");
        el.src = s.url;
        viewerMedia.appendChild(el);

        runProgress(120000);
    } 
    else {
        el = document.createElement("video");
        el.src = s.url;
        el.autoplay = true;
        el.muted = false;

        el.onloadedmetadata = () => {
            let realDur = el.duration * 1000;
            let maxDur = 120000;

            let dur = Math.min(realDur, maxDur);

            runProgress(dur);

            setTimeout(() => nextStory(), dur);
        };

        viewerMedia.appendChild(el);
    }
}

function runProgress(ms) {
    let fill = document.getElementById("currentFill");
    if (!fill) return;

    fill.style.transition = "none";
    fill.style.width = "0";

    setTimeout(() => {
        fill.style.transition = `width ${ms}ms linear`;
        fill.style.width = "100%";
    }, 50);
}

function stopVideo() {
    let vid = viewerMedia.querySelector("video");
    if (vid) {
        vid.pause();
        vid.currentTime = 0;
        vid.src = "";
    }
}

function nextStory() {
    stopVideo();

    current++;
    if (current >= stories.length) closeViewer();
    else showStory();
}

function prevStory() {
    if (current <= 0) return;

    stopVideo();
    current--;
    showStory();
}

tapRight.onclick = nextStory;
tapLeft.onclick = prevStory;

function closeViewer() {
    stopVideo();
    viewer.style.display = "none";
    deleteBtn.style.display = "none";
}

dots.onclick = () => {
    deleteBtn.style.display =
        deleteBtn.style.display === "block" ? "none" : "block";
};

deleteBtn.onclick = () => {
    stopVideo();
    stories.splice(current, 1);
    closeViewer();
    updateThumb();
};
</script>

<!-- ===================== FEED / MURAL ===================== -->
<div class="create-post">
    <input type="text" id="postText" class="input-box"
           placeholder="No que voc√™ est√° pensando?"
           oninput="updateButton()">

    <div class="add-btn" id="btnMain" onclick="buttonAction()">+</div>
    <input type="file" id="fileInput" accept="image/*,video/*">
</div>

<div class="preview" id="previewBox">
    <h3>Pr√©via da m√≠dia</h3>
    <div id="previewContent"></div>
    <button class="add-btn" style="width:100%;" onclick="postar()">POSTAR</button>
</div>

<div id="feed"></div>

<script>
/* ---------------- FEED SCRIPT COMPLETO ---------------- */

let selectedFile = null;
let mode = "add";
let curtidas = {};
let longPress = {};
let holdTimer = null;

/* BOT√ÉO WHATSAPP / + */
function updateButton(){
    let t = postText.value.trim();

    if(t.length > 0){
        btnMain.className = "whatsapp-send";
        btnMain.innerHTML = "‚û§";
        mode = "postar";
    } else {
        btnMain.className = "add-btn";
        btnMain.innerHTML = "+";
        mode = "add";
    }
}

function buttonAction(){
    mode === "add" ? fileInput.click() : postarTexto();
}

fileInput.onchange = e =>{
    selectedFile = e.target.files[0];
    if(!selectedFile) return;

    let url = URL.createObjectURL(selectedFile);

    previewContent.innerHTML =
        selectedFile.type.startsWith("image/")
        ? `<img src="${url}" style="width:100%;border-radius:10px;">`
        : `<video src="${url}" controls style="width:100%;border-radius:10px;"></video>`;

    previewBox.style.display = "block";
};

function postarTexto(){
    let t = postText.value.trim();
    if(t==="") return;

    criarPost(t, null, null);

    postText.value = "";
    updateButton();
}

function postar(){
    let url = URL.createObjectURL(selectedFile);

    criarPost(postText.value, url, selectedFile);

    selectedFile = null;
    postText.value = "";
    previewBox.style.display = "none";
    updateButton();
}

function criarPost(texto, url, file){
    const id = "post_" + Date.now();

    curtidas[id] = { total:0, voce:false, amei:false };
    longPress[id] = false;

    let midia = "";
    if(file){
        midia = file.type.startsWith("image/")
        ? `<img src="${url}">`
        : `<video src="${url}" controls></video>`;
    }

    feed.innerHTML =
    `
    <div class="post" id="${id}">
        
        <div class="menu-btn" onclick="toggleMenu('${id}')">‚ãÆ</div>
        <div class="menu-box" id="menu_${id}">
            <div onclick="excluirPost('${id}')">Excluir postagem</div>
        </div>

        <h3>üåü Usu√°rio Neon</h3>
        <p>${texto}</p>
        ${midia}

        <div class="post-actions">

            <div style="text-align:center;">
                <div class="btn-action"
                     id="curtir_${id}"
                     onmousedown="pressionarCurtir('${id}')"
                     onmouseup="soltarCurtir('${id}')"
                     onclick="curtir('${id}')">
                     üëç Curtir
                </div>
                <div class="contador" id="contadorCurtidas_${id}"></div>
            </div>

            <div style="text-align:center;">
                <div class="btn-action" onclick="abrirComentarios('${id}')">
                    üí¨ Comentar
                </div>
                <div class="contador" id="contadorComentarios_${id}"></div>
            </div>

            <div class="btn-action">‚ÜóÔ∏è Compartilhar</div>

        </div>

        <!-- Coment√°rios -->
        <div class="coment-area" id="comentarios_${id}">
            <div id="listaComentarios_${id}" style="margin-bottom:15px;"></div>

            <input type="text" id="comentarioInput_${id}"
                   placeholder="Escreva um coment√°rio..."
                   style="width:100%;padding:10px;border-radius:8px;
                   border:1px solid #00ff9d;background:#000;color:#fff;">

            <button onclick="enviarComentario('${id}')"
                    style="margin-top:8px;background:#00ff9d;border:none;
                    padding:8px 15px;border-radius:8px;cursor:pointer;">
                Enviar
            </button>
        </div>

    </div>
    ` + feed.innerHTML;
}

function toggleMenu(id){
    let m = document.getElementById("menu_"+id);
    m.style.display = m.style.display==="block" ? "none" : "block";
}

function excluirPost(id){
    document.getElementById(id).remove();
}

/* CURTIR / AMEI */
function pressionarCurtir(id){
    longPress[id] = false;
    holdTimer = setTimeout(()=>{
        longPress[id] = true;
        amei(id);
    }, 500);
}

function soltarCurtir(id){
    if(holdTimer) clearTimeout(holdTimer);
}

function curtir(id){
    const dados = curtidas[id];
    const btn = document.getElementById("curtir_"+id);

    if(longPress[id]){
        longPress[id] = false;
        return;
    }

    if(dados.voce || dados.amei){
        dados.voce=false;
        dados.amei=false;
        if(dados.total>0) dados.total--;
        btn.textContent="üëç Curtir";
        btn.style.color="#00ff9d";
    } else {
        dados.voce=true;
        dados.amei=false;
        dados.total++;
        btn.textContent="üëç Voc√™ curtiu";
        btn.style.color="#00ff9d";
    }
    atualizarCurtidas(id);
}

function amei(id){
    const dados = curtidas[id];
    const btn = document.getElementById("curtir_"+id);

    if(dados.amei){
        dados.amei=false;
        dados.voce=false;
        if(dados.total>0) dados.total--;
        btn.textContent="üëç Curtir";
        btn.style.color="#00ff9d";
    } else {
        if(!dados.voce) dados.total++;
        dados.voce=true;
        dados.amei=true;
        btn.textContent="‚ù§Ô∏è Voc√™ amou";
        btn.style.color="#ff008c";
    }

    atualizarCurtidas(id);
}

function atualizarCurtidas(id){
    const cont = document.getElementById("contadorCurtidas_"+id);
    const t = curtidas[id].total;
    if(t===0) cont.innerHTML="";
    else if(t===1) cont.innerHTML="Voc√™ curtiu";
    else cont.innerHTML=`Voc√™ e mais ${t-1} curtiram`;
}

/* ----------- COMENT√ÅRIOS (ATUALIZADO COM FECHAR FORA) ----------- */
function abrirComentarios(id){
    const box = document.getElementById("comentarios_"+id);
    box.style.display = "block";

    document.removeEventListener("click", fecharBox);

    function fecharBox(e){
        const insideBox = box.contains(e.target);
        const clickedButton = e.target.closest(".btn-action");

        if(!insideBox && !clickedButton){
            box.style.display = "none";
            document.removeEventListener("click", fecharBox);
        }
    }

    setTimeout(()=> document.addEventListener("click", fecharBox), 50);
}

function enviarComentario(id){
    const input = document.getElementById("comentarioInput_"+id);
    const texto = input.value.trim();
    if(texto==="") return;

    const lista = document.getElementById("listaComentarios_"+id);
    const contador = document.getElementById("contadorComentarios_"+id);

    lista.innerHTML += `
        <div style="background:#000;border:1px solid #00ff9d;padding:8px;
                    border-radius:8px;margin-bottom:5px;">
            üí¨ ${texto}
        </div>
    `;

    input.value="";

    let total = lista.children.length;
    contador.innerHTML = total===1 ? "1 coment√°rio" : `${total} coment√°rios`;
}
</script>

</body>
</html>
