<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Carteira de Cambone</title>

<!-- GOOGLE LOGIN -->
<script src="https://accounts.google.com/gsi/client" async defer></script>

<style>
/* üî• TELA PRETA DE LOGIN */
#loginTela {
    position: fixed;
    top: 0; left: 0;
    width: 100%; height: 100%;
    background: #000;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    z-index: 99999;
}

#loginTela img {
    width: 200px;
    margin-bottom: 25px;
}

#googleLogin { margin-top: 15px; }

/* üî• OCULTAR CONTE√öDO ANTES DO LOGIN */
#conteudo { display: none; }

/* üî• ESTILO PADR√ÉO DA CARTEIRA SEM FUNDO */
body {
    font-family: Arial, sans-serif;
    background: #e6e6e6;
    padding: 20px;
    display: flex;
    flex-direction: column;
    align-items: center;
}

.carteira {
    width: 920px;
    min-height: 360px;
    background: white; /* sem fundo */
    border-radius: 16px;
    border: 3px solid #0f5e29;
    display: flex;
    justify-content: space-between;
    padding: 25px;
    box-shadow: 0 0 20px rgba(0,0,0,0.22);
}

.lado {
    width: 48%;
    background: rgba(255,255,255,0.85);
    padding: 15px;
    border-radius: 10px;
    box-sizing: border-box;
}

.titulo {
    font-weight: bold;
    text-align: center;
    margin-bottom: 10px;
    font-size: 14px;
    color: #0f5e29;
}

.campo {
    font-size: 12px;
    margin-bottom: 6px;
    line-height: 1.2;
    color: #000;
}

.campo span {
    font-weight: bold;
    color: #0f5e29;
}

.escrito {
    font-family: "Comic Sans MS", cursive;
    font-size: 16px;
    color: #0047ab;
    font-weight: bold;
}

.upload-foto {
    width: 110px;
    height: 140px;
    border-radius: 6px;
    border: 2px dashed #0f5e29;
    background: rgba(255,255,255,0.6);
    cursor: pointer;
    margin-top: 15px;
    text-align: center;
    font-size: 11px;
    color: #0f5e29;
    overflow: hidden;
    display: flex;
    align-items: center;
    justify-content: center;
}

.upload-foto img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    display: none;
}

input[type="file"] { display: none; }

.assinatura-img {
    width: 90px;
    margin-left: 10px;
    filter: contrast(1.2);
}

.formulario {
    width: 920px;
    margin-top: 20px;
    background: #fff;
    padding: 15px;
    border-radius: 10px;
    border: 2px solid #0f5e29;
}

.formulario label { font-weight: bold; color: #0f5e29; }

.formulario input {
    width: 100%;
    padding: 6px;
    font-size: 14px;
    margin-top: 3px;
    border: 1px solid #0f5e29;
    border-radius: 5px;
}

.btn-salvar, .btn-editar {
    padding: 12px;
    width: 100%;
    background: #0f5e29;
    color: #fff;
    border-radius: 8px;
    border: none;
    cursor: pointer;
    margin-top: 10px;
    font-size: 16px;
}
</style>
</head>
<body>

<!-- üî• TELA PRETA DE LOGIN -->
<div id="loginTela">
    <img src="https://i.ibb.co/4RnPgkSN/5c081edd-21e9-48fb-9a91-834cfdd112fc-removebg-preview.png">
    <div id="googleLogin"></div>
    <div id="debug" style="color:red; margin-top:15px;"></div>
</div>

<!-- üî• CONTE√öDO DA CARTEIRINHA (mostra s√≥ ap√≥s login) -->
<div id="conteudo">

<div class="carteira">

    <div class="lado">
        <div class="titulo">C.E.U S√ÉO SEBASTI√ÉO REI OXOSSI</div>

        <div class="campo">Rua A n¬∫ 1058 ‚Äì Coa√ßu ‚Äì Messejana ‚Äì Fortaleza ‚Äì CE</div>
        <div class="campo">Sacerdote: Pai M√°rcio de Ox√≥ssi ‚Äî CNPJ: 50.446.555/0001-30</div>
        <div class="campo">Fone: (85) 9 8696-6786</div>

        <hr>

        <div class="campo"><span>Nome:</span> <span id="nomeTexto" class="escrito">_________</span></div>
        <div class="campo"><span>Estado Civil:</span> <span id="civilTexto" class="escrito">_________</span></div>
        <div class="campo"><span>Endere√ßo:</span> <span id="endTexto" class="escrito">_________</span></div>
        <div class="campo"><span>RG:</span> <span id="rgTexto" class="escrito">_________</span></div>
        <div class="campo"><span>CPF:</span> <span id="cpfTexto" class="escrito">_________</span></div>
        <div class="campo"><span>Cargo:</span> <span id="cargoTexto" class="escrito">_________</span></div>
    </div>

    <div class="lado">

        <div class="campo" style="font-size:13px;">
            O C√≥digo Penal Brasileiro (Decreto-Lei 2.848/1940) estabelece que √© crime
            vilipendiar ato ou objeto de culto religioso.
        </div>

        <div class="campo" style="margin-top:10px;">
            <span>V√°lida at√©:</span> <span class="escrito">00160</span>
        </div>

        <!-- FOTO DO MEMBRO -->
        <label class="upload-foto" for="fileInput">
            <span id="textoFoto">Enviar Foto</span>
            <img id="previewFoto">
        </label>

        <input type="file" id="fileInput" accept="image/*">

        <div class="campo" style="margin-top:10px; display:flex; align-items:center;">
            <span>Assinatura da Dirigente:</span>
            <img class="assinatura-img"
             src="https://i.ibb.co/FL7Sb2zF/Captura-de-tela-2025-11-22-223959.png">
        </div>

    </div>
</div>

<!-- FORMUL√ÅRIO -->
<div id="formulario" class="formulario">
    <div><label>Nome:</label><input type="text" id="nomeInput"></div>
    <div><label>Estado Civil:</label><input type="text" id="civilInput"></div>
    <div><label>Endere√ßo:</label><input type="text" id="endInput"></div>
    <div><label>RG:</label><input type="text" id="rgInput"></div>
    <div><label>CPF:</label><input type="text" id="cpfInput"></div>
    <div><label>Cargo:</label><input type="text" id="cargoInput"></div>

    <button class="btn-salvar" onclick="salvar()">SALVAR INFORMA√á√ïES</button>
</div>

<button id="btnEditar" class="btn-editar" style="display:none;" onclick="editar()">
    ATUALIZAR INFORMA√á√ïES
</button>

</div><!-- FIM DO CONTE√öDO -->
<!-- ===================== LOGIN GOOGLE (CLIENTE GSI) ===================== -->
<script>
document.addEventListener("DOMContentLoaded", function () {

    if (!google || !google.accounts || !google.accounts.id) {
        debug.innerText = "‚ùå ERRO: Google Identity n√£o carregou.";
        return;
    }

    google.accounts.id.initialize({
        client_id: "627442405379-srqriainr8okj7ldg96njd1va5bvt7oi.apps.googleusercontent.com",
        callback: googleLoginOK
    });

    google.accounts.id.renderButton(
        document.getElementById("googleLogin"),
        { theme: "filled_white", size: "large", width: 260 }
    );

    google.accounts.id.prompt();
});

/* Quando Google retornar o token */
function googleLoginOK(response) {
    if (!response || !response.credential) {
        debug.innerText = "‚ùå ERRO: Google retornou token inv√°lido.";
        return;
    }

    window.googleToken = response.credential;

    /* Dispara evento para Firebase pegar esse token */
    window.dispatchEvent(new Event("GoogleOK"));
}
</script>

<!-- ===================== FIREBASE - APP + AUTH ===================== -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.14.0/firebase-app.js";
import {
    getAuth, GoogleAuthProvider, signInWithCredential, onAuthStateChanged
} from "https://www.gstatic.com/firebasejs/10.14.0/firebase-auth.js";

/* CONFIG DO SEU FIREBASE */
const firebaseConfig = {
    apiKey: "AIzaSyAt4CeGjdbjzdtMH1qZHw6RuBFJ6SeTDKk",
    authDomain: "coletivo-f34d4.firebaseapp.com",
    databaseURL: "https://coletivo-f34d4-default-rtdb.firebaseio.com",
    projectId: "coletivo-f34d4",
    storageBucket: "coletivo-f34d4.firebasestorage.app",
    messagingSenderId: "296376447787",
    appId: "1:296376447787:web:1341c59c8087d6ac1e4b6e"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth();

/* Quando o Google finalizar, o Firebase faz login */
window.addEventListener("GoogleOK", () => {
    try {
        const cred = GoogleAuthProvider.credential(window.googleToken);
        signInWithCredential(auth, cred);
    } catch (e) {
        debug.innerText = "‚ùå ERRO FIREBASE LOGIN: " + e.message;
    }
});

/* Depois de logado */
onAuthStateChanged(auth, (user) => {
    if (!user) return;

    window.user = user;

    loginTela.style.display = "none";
    conteudo.style.display = "block";

    /* Chama fun√ß√£o que vai carregar dados do usu√°rio */
    carregar();
});
/* ===================== DATABASE + STORAGE ===================== */
import {
    getDatabase, ref, set, get
} from "https://www.gstatic.com/firebasejs/10.14.0/firebase-database.js";

import {
    getStorage, ref as sRef, uploadString, getDownloadURL
} from "https://www.gstatic.com/firebasejs/10.14.0/firebase-storage.js";

const db = getDatabase();
const storage = getStorage();

/* ===================== FUN√á√ÉO CARREGAR DADOS ===================== */
window.carregar = async function () {
    const snap = await get(ref(db, "carteirinhas/" + user.uid));

    if (snap.exists()) {
        const d = snap.val();

        /* Campos de texto na carteirinha */
        nomeTexto.innerText  = d.nome  || "_________";
        civilTexto.innerText = d.civil || "_________";
        endTexto.innerText   = d.end   || "_________";
        rgTexto.innerText    = d.rg    || "_________";
        cpfTexto.innerText   = d.cpf   || "_________";
        cargoTexto.innerText = d.cargo || "_________";

        /* Inputs do formul√°rio */
        nomeInput.value  = d.nome  || "";
        civilInput.value = d.civil || "";
        endInput.value   = d.end   || "";
        rgInput.value    = d.rg    || "";
        cpfInput.value   = d.cpf   || "";
        cargoInput.value = d.cargo || "";

        /* Foto */
        if (d.foto) {
            previewFoto.src = d.foto;
            previewFoto.style.display = "block";
            textoFoto.style.display = "none";
        }

        formulario.style.display = "none";
        btnEditar.style.display = "block";
    }
};

/* ===================== SALVAR NO FIREBASE ===================== */
window.salvar = async function () {
    let fotoURL = null;

    /* Se usu√°rio enviou foto */
    if (previewFoto.src && previewFoto.style.display !== "none") {
        const fotoRef = sRef(storage, "carteirinhas/" + user.uid + ".jpg");

        await uploadString(fotoRef, previewFoto.src, "data_url");

        fotoURL = await getDownloadURL(fotoRef);
    }

    /* Salva os dados */
    await set(ref(db, "carteirinhas/" + user.uid), {
        nome: nomeInput.value.trim(),
        civil: civilInput.value.trim(),
        end: endInput.value.trim(),
        rg: rgInput.value.trim(),
        cpf: cpfInput.value.trim(),
        cargo: cargoInput.value.trim(),
        foto: fotoURL
    });

    alert("Informa√ß√µes atualizadas!");
    carregar();
};

/* ===================== ATIVAR EDI√á√ÉO ===================== */
window.editar = function () {
    formulario.style.display = "block";
    btnEditar.style.display = "none";
};

/* ===================== PREVIEW DA FOTO ===================== */
fileInput.addEventListener("change", function () {
    const file = this.files[0];
    const r = new FileReader();

    r.onload = e => {
        previewFoto.src = e.target.result;
        previewFoto.style.display = "block";
        textoFoto.style.display = "none";
    };

    r.readAsDataURL(file);
});
</script>
