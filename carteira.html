<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Carteira de Cambone</title>

<!-- GOOGLE LOGIN -->
<script src="https://accounts.google.com/gsi/client"></script>

<style>
/* TELA PRETA */
#loginTela {
    position: fixed;
    top: 0; left: 0;
    width: 100%; height: 100%;
    background: #000;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    z-index: 99999;
}

#loginTela img {
    width: 200px;
    margin-bottom: 25px;
}

#googleLogin {
    background: transparent;
    padding: 10px;
}

/* OCULTAR CONTE√öDO */
#conteudo { display: none; }

/* ESTILO DA CARTEIRA */
body {
    font-family: Arial, sans-serif;
    background: #e6e6e6;
    padding: 20px;
    display: flex;
    flex-direction: column;
    align-items: center;
}
</style>
</head>
<body>

<!-- LOGIN -->
<div id="loginTela">
    <img src="https://i.ibb.co/4RnPgkSN/5c081edd-21e9-48fb-9a91-834cfdd112fc-removebg-preview.png">
    <div id="googleLogin"></div>

    <!-- DEBUG (MOSTRA ERROS) -->
    <div id="debug" style="color:red; font-size:14px; margin-top:20px;"></div>
</div>

<!-- CONTE√öDO DA CARTEIRA -->
<div id="conteudo">
    <h1>LOGIN OK ‚Äî CARTEIRA AQUI</h1>
</div>

<!-- ---------------- GOOGLE LOGIN (sempre fora do m√≥dulo) ---------------- -->
<script>
document.addEventListener("DOMContentLoaded", function () {

    console.log("DOM carregado ‚Äî iniciando Google Login");

    if (!google || !google.accounts || !google.accounts.id) {
        document.getElementById("debug").innerText = "‚ùå ERRO: Google Identity N√ÉO carregou!";
        return;
    }

    google.accounts.id.initialize({
        client_id: "627442405379-srqriainr8okj7ldg96njd1va5bvt7oi.apps.googleusercontent.com",
        callback: googleLoginOK
    });

    google.accounts.id.renderButton(
        document.getElementById("googleLogin"),
        { theme: "filled_white", size: "large", width: 260 }
    );

    google.accounts.id.prompt();
});

function decodeJwt(token) {
    return JSON.parse(atob(token.split('.')[1]));
}

function googleLoginOK(response) {
    if (!response || !response.credential) {
        document.getElementById("debug").innerText = "‚ùå ERRO: Google retornou resposta inv√°lida.";
        return;
    }

    window.googleToken = response.credential;

    // Dispara evento para o Firebase fazer login
    window.dispatchEvent(new Event("GoogleOK"));
}
</script>

<!-- ---------------- FIREBASE (EM M√ìDULO) ---------------- -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.14.0/firebase-app.js";
import {
    getAuth, GoogleAuthProvider, signInWithCredential, onAuthStateChanged
} from "https://www.gstatic.com/firebasejs/10.14.0/firebase-auth.js";

const firebaseConfig = {
    apiKey: "AIzaSyAt4CeGjdbjzdtMH1qZHw6RuBFJ6SeTDKk",
    authDomain: "coletivo-f34d4.firebaseapp.com",
    databaseURL: "https://coletivo-f34d4-default-rtdb.firebaseio.com",
    projectId: "coletivo-f34d4",
    storageBucket: "coletivo-f34d4.firebasestorage.app",
    messagingSenderId: "296376447787",
    appId: "1:296376447787:web:1341c59c8087d6ac1e4b6e"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth();

/* QUANDO O GOOGLE FINALIZAR O LOGIN */
window.addEventListener("GoogleOK", () => {
    try {
        const cred = GoogleAuthProvider.credential(window.googleToken);
        signInWithCredential(auth, cred);
    } catch (e) {
        document.getElementById("debug").innerText = "ERRO FIREBASE: " + e.message;
    }
});

/* LOGADO */
onAuthStateChanged(auth, (user) => {
    if (user) {
        loginTela.style.display = "none";
        conteudo.style.display = "block";
    }
});
</script>

</body>
</html>


<!-- üî• CONTE√öDO DA CARTEIRA -->
<div id="conteudo">

<div class="carteira">

    <div class="lado">
        <div class="titulo">C.E.U S√ÉO SEBASTI√ÉO REI OXOSSI</div>

        <div class="campo">Rua A n¬∫ 1058 ‚Äì Coa√ßu ‚Äì Messejana ‚Äì Fortaleza ‚Äì CE</div>
        <div class="campo">Sacerdote: Pai M√°rcio de Ox√≥ssi ‚Äì CNPJ: 50.446.555/0001-30</div>
        <div class="campo">Fone: (85) 9 8696-6786</div>

        <hr>

        <div class="campo"><span>Nome:</span> <span id="nomeTexto" class="escrito">_________</span></div>
        <div class="campo"><span>Estado Civil:</span> <span id="civilTexto" class="escrito">_________</span></div>
        <div class="campo"><span>Endere√ßo:</span> <span id="endTexto" class="escrito">_________</span></div>
        <div class="campo"><span>RG:</span> <span id="rgTexto" class="escrito">_________</span></div>
        <div class="campo"><span>CPF:</span> <span id="cpfTexto" class="escrito">_________</span></div>
        <div class="campo"><span>Cargo:</span> <span id="cargoTexto" class="escrito">_________</span></div>
    </div>

    <div class="lado">

        <div class="campo" style="font-size:13px; color:#000;">
            O C√≥digo Penal Brasileiro (Decreto-Lei 2.848/1940), em seu artigo 208,
            estabelece que √© crime ‚Äúescarnecer de algu√©m publicamente, por motivo de cren√ßa
            ou fun√ß√£o religiosa; impedir ou perturbar cerim√¥nia ou pr√°tica de culto religioso;
            vilipendiar publicamente ato ou objeto de culto religioso‚Äù.
        </div>

        <div class="campo" style="margin-top:10px;">
            <span>V√°lida at√©:</span> <span class="escrito">00160</span>
        </div>

        <label class="upload-foto" for="fileInput">
            <span id="textoFoto">Clique para enviar<br>uma foto</span>
            <img id="previewFoto">
        </label>

        <input type="file" id="fileInput" accept="image/*">

        <div class="campo" style="margin-top:10px; display:flex; align-items:center; color:#000;">
            <span>Assinatura da Dirigente:</span>

            <img class="assinatura-img"
                 src="https://i.ibb.co/FL7Sb2zF/Captura-de-tela-2025-11-22-223959.png">
        </div>

    </div>
</div>

<!-- FORMUL√ÅRIO -->
<div id="formulario" class="formulario">
    <div><label>Nome:</label><input type="text" id="nomeInput"></div>
    <div><label>Estado Civil:</label><input type="text" id="civilInput"></div>
    <div><label>Endere√ßo:</label><input type="text" id="endInput"></div>
    <div><label>RG:</label><input type="text" id="rgInput"></div>
    <div><label>CPF:</label><input type="text" id="cpfInput"></div>
    <div><label>Cargo:</label><input type="text" id="cargoInput"></div>

    <button class="btn-salvar" onclick="salvar()">SALVAR INFORMA√á√ïES</button>
</div>

<button id="btnEditar" class="btn-editar" style="display:none;" onclick="editar()">ATUALIZAR INFORMA√á√ïES</button>

</div> <!-- FIM CONTE√öDO -->

<!-- üî•üî• SCRIPTS FIREBASE + LOGIN + SALVAR + CARREGAR -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.14.0/firebase-app.js";
import { 
    getAuth, signInWithCredential, GoogleAuthProvider, onAuthStateChanged 
} from "https://www.gstatic.com/firebasejs/10.14.0/firebase-auth.js";
import { 
    getDatabase, ref, set, get 
} from "https://www.gstatic.com/firebasejs/10.14.0/firebase-database.js";
import {
    getStorage, ref as sRef, uploadString, getDownloadURL
} from "https://www.gstatic.com/firebasejs/10.14.0/firebase-storage.js";

/* üî• CONFIG FIREBASE */
const firebaseConfig = {
    apiKey: "AIzaSyAt4CeGjdbjzdtMH1qZHw6RuBFJ6SeTDKk",
    authDomain: "coletivo-f34d4.firebaseapp.com",
    databaseURL: "https://coletivo-f34d4-default-rtdb.firebaseio.com",
    projectId: "coletivo-f34d4",
    storageBucket: "coletivo-f34d4.firebasestorage.app",
    messagingSenderId: "296376447787",
    appId: "1:296376447787:web:1341c59c8087d6ac1e4b6e"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth();
const db = getDatabase();
const storage = getStorage();

/* üî• CONFIG BOT√ÉO GOOGLE */
google.accounts.id.initialize({
    client_id: "627442405379-srqriainr8okj7ldg96njd1va5bvt7oi.apps.googleusercontent.com",
    callback: loginGoogle
});

google.accounts.id.renderButton(
    document.getElementById("googleLogin"),
    { theme: "filled_white", size: "large" }
);

/* LOGIN GOOGLE */
function loginGoogle(response) {
    const cred = GoogleAuthProvider.credential(response.credential);
    signInWithCredential(auth, cred);
}

/* QUANDO ESTIVER LOGADO */
onAuthStateChanged(auth, async (user) => {
    if (!user) return;

    window.user = user;

    loginTela.style.display = "none";
    conteudo.style.display = "block";

    carregar();
});

/* CARREGAR DADOS */
async function carregar() {
    const snap = await get(ref(db, "carteirinhas/" + user.uid));

    if (snap.exists()) {
        const d = snap.val();

        nomeTexto.innerText = d.nome || "________";
        civilTexto.innerText = d.civil || "________";
        endTexto.innerText = d.end || "________";
        rgTexto.innerText = d.rg || "________";
        cpfTexto.innerText = d.cpf || "________";
        cargoTexto.innerText = d.cargo || "________";

        nomeInput.value = d.nome || "";
        civilInput.value = d.civil || "";
        endInput.value = d.end || "";
        rgInput.value = d.rg || "";
        cpfInput.value = d.cpf || "";
        cargoInput.value = d.cargo || "";

        if (d.foto) {
            previewFoto.src = d.foto;
            previewFoto.style.display = "block";
            textoFoto.style.display = "none";
        }

        formulario.style.display = "none";
        btnEditar.style.display = "block";
    }
}

/* SALVAR */
window.salvar = async function() {

    let fotoURL = null;

    if (previewFoto.src && previewFoto.style.display !== "none") {
        const fotoRef = sRef(storage, "carteirinhas/" + user.uid + ".jpg");

        await uploadString(fotoRef, previewFoto.src, "data_url");

        fotoURL = await getDownloadURL(fotoRef);
    }

    await set(ref(db, "carteirinhas/" + user.uid), {
        nome: nomeInput.value,
        civil: civilInput.value,
        end: endInput.value,
        rg: rgInput.value,
        cpf: cpfInput.value,
        cargo: cargoInput.value,
        foto: fotoURL
    });

    alert("Informa√ß√µes salvas!");
    carregar();
};

/* EDITAR */
window.editar = function() {
    formulario.style.display = "block";
    btnEditar.style.display = "none";
};

/* FOTO PREVIEW */
fileInput.addEventListener("change", function() {
    const file = this.files[0];
    const r = new FileReader();
    r.onload = e => {
        previewFoto.src = e.target.result;
        previewFoto.style.display = "block";
        textoFoto.style.display = "none";
    };
    r.readAsDataURL(file);
});
</script>

</body>
</html>
