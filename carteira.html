<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Carteira de Cambone</title>

<!-- GOOGLE LOGIN -->
<script src="https://accounts.google.com/gsi/client"></script>

<style>
/* TELA PRETA */
#loginTela {
    position: fixed;
    top: 0; left: 0;
    width: 100%; height: 100%;
    background: #000;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    z-index: 99999;
}

#loginTela img {
    width: 200px;
    margin-bottom: 25px;
}

#googleLogin {
    background: transparent;
    padding: 10px;
}

/* OCULTAR CONTEÚDO */
#conteudo { display: none; }

/* ESTILO DA CARTEIRA */
body {
    font-family: Arial, sans-serif;
    background: #e6e6e6;
    padding: 20px;
    display: flex;
    flex-direction: column;
    align-items: center;
}
</style>
</head>
<body>

<!-- LOGIN -->
<div id="loginTela">
    <img src="https://i.ibb.co/4RnPgkSN/5c081edd-21e9-48fb-9a91-834cfdd112fc-removebg-preview.png">
    <div id="googleLogin"></div>

    <!-- DEBUG (MOSTRA ERROS) -->
    <div id="debug" style="color:red; font-size:14px; margin-top:20px;"></div>
</div>

<!-- CONTEÚDO DA CARTEIRA -->
<div id="conteudo">
    <h1>LOGIN OK — CARTEIRA AQUI</h1>
</div>

<!-- ---------------- GOOGLE LOGIN (sempre fora do módulo) ---------------- -->
<script>
document.addEventListener("DOMContentLoaded", function () {

    console.log("DOM carregado — iniciando Google Login");

    if (!google || !google.accounts || !google.accounts.id) {
        document.getElementById("debug").innerText = "❌ ERRO: Google Identity NÃO carregou!";
        return;
    }

    google.accounts.id.initialize({
        client_id: "627442405379-srqriainr8okj7ldg96njd1va5bvt7oi.apps.googleusercontent.com",
        callback: googleLoginOK
    });

    google.accounts.id.renderButton(
        document.getElementById("googleLogin"),
        { theme: "filled_white", size: "large", width: 260 }
    );

    google.accounts.id.prompt();
});

function decodeJwt(token) {
    return JSON.parse(atob(token.split('.')[1]));
}

function googleLoginOK(response) {
    if (!response || !response.credential) {
        document.getElementById("debug").innerText = "❌ ERRO: Google retornou resposta inválida.";
        return;
    }

    window.googleToken = response.credential;

    // Dispara evento para o Firebase fazer login
    window.dispatchEvent(new Event("GoogleOK"));
}
</script>

<!-- ---------------- FIREBASE (EM MÓDULO) ---------------- -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.14.0/firebase-app.js";
import {
    getAuth, GoogleAuthProvider, signInWithCredential, onAuthStateChanged
} from "https://www.gstatic.com/firebasejs/10.14.0/firebase-auth.js";

const firebaseConfig = {
    apiKey: "AIzaSyAt4CeGjdbjzdtMH1qZHw6RuBFJ6SeTDKk",
    authDomain: "coletivo-f34d4.firebaseapp.com",
    databaseURL: "https://coletivo-f34d4-default-rtdb.firebaseio.com",
    projectId: "coletivo-f34d4",
    storageBucket: "coletivo-f34d4.firebasestorage.app",
    messagingSenderId: "296376447787",
    appId: "1:296376447787:web:1341c59c8087d6ac1e4b6e"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth();

/* QUANDO O GOOGLE FINALIZAR O LOGIN */
window.addEventListener("GoogleOK", () => {
    try {
        const cred = GoogleAuthProvider.credential(window.googleToken);
        signInWithCredential(auth, cred);
    } catch (e) {
        document.getElementById("debug").innerText = "ERRO FIREBASE: " + e.message;
    }
});

/* LOGADO */
onAuthStateChanged(auth, (user) => {
    if (user) {
        loginTela.style.display = "none";
        conteudo.style.display = "block";
    }
});
</script>

</body>
</html>
